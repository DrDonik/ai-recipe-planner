---
name: Wire error notifications in SettingsContext, App.tsx, and ShoppingList
status: open
created: 2026-02-23T09:13:23Z
updated: 2026-02-23T09:13:23Z
github: [Will be updated when synced to GitHub]
depends_on: [001, 002]
parallel: false
conflicts_with: []
---

# Task: Wire error notifications in SettingsContext, App.tsx, and ShoppingList

## Description

Connect the `persistError` flags from all `useLocalStorage` / `useStringLocalStorage` call sites to the existing notification system. Ensure a single deduplicated notification is shown when any persistence error occurs.

## Acceptance Criteria

- [ ] `SettingsContext` exposes a `storagePersistError: boolean` on its context value (OR of all 7 internal hook errors)
- [ ] `App.tsx` watches `persistError` from its 9 direct hook calls + `storagePersistError` from context
- [ ] A single `useEffect` in `App.tsx` fires `showNotification({ message: t.storageError, type: 'error' })` when any flag is `true`
- [ ] Notification does NOT auto-dismiss (no `timeout` property)
- [ ] A ref guard prevents duplicate notifications — fires once per error episode
- [ ] Notification resets (guard clears) when all errors resolve
- [ ] `ShoppingList.tsx` destructures `persistError` and fires `onShowNotification` when `true`
- [ ] Integration test: mock `localStorage.setItem` to throw, verify notification appears
- [ ] Integration test: verify only one notification for multiple simultaneous errors
- [ ] All existing tests pass

## Technical Details

**Files modified:**
- `src/contexts/SettingsContext.tsx` — Destructure `persistError` from 7 hooks, derive `storagePersistError`, add to context value and type
- `src/App.tsx` — Destructure `persistError` from 9 hooks, read `storagePersistError` from context, add `useEffect` + ref guard for notification
- `src/components/ShoppingList.tsx` — Destructure `persistError` from 1 hook, add `useEffect` to call `onShowNotification`

**New/updated test files:**
- `src/__tests__/components/ShoppingList.test.tsx` — Test that notification fires on persist error
- `src/__tests__/App.test.tsx` — Test notification display and deduplication

**Notification pattern in App.tsx:**
```typescript
const storageErrorShownRef = useRef(false);
const anyPersistError = persistError1 || persistError2 || ... || storagePersistError;

useEffect(() => {
  if (anyPersistError && !storageErrorShownRef.current) {
    showNotification({ message: t.storageError, type: 'error' });
    storageErrorShownRef.current = true;
  }
  if (!anyPersistError) {
    storageErrorShownRef.current = false;
  }
}, [anyPersistError, showNotification, t.storageError]);
```

## Dependencies

- [ ] Task 001: `persistError` flag must be available from hooks
- [ ] Task 002: `t.storageError` translation key must exist

## Effort Estimate

- Size: M
- Parallel: false (depends on 001 + 002)

## Definition of Done

- [ ] Code implemented
- [ ] Tests written and passing
- [ ] All existing tests pass (`npm test`)
- [ ] Build passes (`npm run build`)
