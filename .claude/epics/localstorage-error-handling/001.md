---
name: Add persistError flag to localStorage hooks
status: open
created: 2026-02-23T09:13:23Z
updated: 2026-02-23T09:13:23Z
github: [Will be updated when synced to GitHub]
depends_on: []
parallel: false
conflicts_with: [002, 003]
---

# Task: Add persistError flag to localStorage hooks

## Description

Extend both `useLocalStorage<T>` and `useStringLocalStorage` to track and expose a `persistError` boolean as the third tuple element. Add unit tests covering the error path.

## Acceptance Criteria

- [ ] `useLocalStorage` returns `[state, setState, persistError] as const`
- [ ] `useStringLocalStorage` returns `[state, setState, persistError] as const`
- [ ] `persistError` is `true` when `localStorage.setItem` throws (e.g., `QuotaExceededError`)
- [ ] `persistError` resets to `false` on the next successful write
- [ ] Existing destructuring `[state, setState]` at all call sites continues to work unchanged
- [ ] Unit tests verify error flag toggles correctly for both hooks
- [ ] Unit tests verify the flag resets after a successful write
- [ ] All existing `useLocalStorage` tests still pass

## Technical Details

**File:** `src/hooks/useLocalStorage.ts`

Changes to both hooks:
1. Add `const [persistError, setPersistError] = useState(false)`
2. In the `useEffect` write path: call `setPersistError(false)` on success, `setPersistError(true)` in the catch block
3. Change return to include `persistError` as third element

**Test file:** `src/__tests__/hooks/useLocalStorage.test.ts`

Add test cases:
- Mock `localStorage.setItem` to throw `DOMException('QuotaExceededError')`, verify `persistError` becomes `true`
- Restore `setItem`, trigger a write, verify `persistError` becomes `false`
- Verify both hooks have the same behavior

## Dependencies

- [ ] None

## Effort Estimate

- Size: S
- Parallel: false (foundation for tasks 002 and 003)

## Definition of Done

- [ ] Code implemented
- [ ] Tests written and passing
- [ ] All existing tests pass (`npm test`)
